<!DOCTYPE html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
--><html lang="en" class="no-js">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Local Soft-RoCE development workflow with kind - GitOps</title>
<meta name="description" content="RDMA over Converged Ethernet (RoCE) is a network protocol which allows remote direct memory access (RDMA) over an Ethernet network. There are multiple RoCE versions, in particular the RoCE v2 protocol exists on top of either the UDP/IPv4 or the UDP/IPv6 protocol and destination port number 4791 has been reserved for RoCE v2.">


  <meta name="author" content="Jose Castillo Lema">
  
  <meta property="article:author" content="Jose Castillo Lema">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="GitOps">
<meta property="og:title" content="Local Soft-RoCE development workflow with kind">
<meta property="og:url" content="https://josecastillolema.github.io/roce-local-dev/">


  <meta property="og:description" content="RDMA over Converged Ethernet (RoCE) is a network protocol which allows remote direct memory access (RDMA) over an Ethernet network. There are multiple RoCE versions, in particular the RoCE v2 protocol exists on top of either the UDP/IPv4 or the UDP/IPv6 protocol and destination port number 4791 has been reserved for RoCE v2.">



  <meta property="og:image" content="https://josecastillolema.github.io/assets/images/favicon_io/android-chrome-512x512.png">





  <meta property="article:published_time" content="2025-12-28T00:00:00-06:00">



  <meta property="article:modified_time" content="2025-12-28T00:00:00-06:00">




<link rel="canonical" href="https://josecastillolema.github.io/roce-local-dev/">







  <meta name="google-site-verification" content="googled48a6d8a28aaa375.html">






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="GitOps Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="shortcut icon" type="image/png" href="/assets/images/favicon.ico">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/favicon_io/android-chrome-192x192.png" alt="GitOps"></a>
        
        <a class="site-title" href="/">
          GitOps
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/series/">series</a>
            </li>
<li class="masthead__menu-item">
              <a href="/classes/">classes</a>
            </li>
<li class="masthead__menu-item">
              <a href="/talks/">talks</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">about</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <script lang="javascript" src="/assets/js/vanilla-back-to-top.min.js"></script>
    <script>addBackToTop({
      backgroundColor: '#6F777D',
      textColor: '#fff'
    })</script>

    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://josecastillolema.github.io/">
        <img src="/assets/images/me.jpg" alt="Jose Castillo Lema" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://josecastillolema.github.io/" itemprop="url">Jose Castillo Lema</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Software Engineer @ <strong>RedHat</strong></p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Santiago, Spain</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/josecastillolema" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/jose-castillo-lema" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://www.youracclaim.com/users/jose-castillo-lema" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-angle-double-up" aria-hidden="true"></i><span class="label">Acclaim</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/4288758/jos%c3%a9-castillo-lema" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">StackOverflow</span></a></li>
          
        
          
            <li><a href="https://www.researchgate.net/profile/Jose_Castillo-Lema" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-researchgate" aria-hidden="true"></i><span class="label">ResearchGate</span></a></li>
          
        
          
            <li><a href="https://scholar.google.com.br/citations?user=_xNpHiwAAAAJ" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-google" aria-hidden="true"></i><span class="label">GoogleScholar</span></a></li>
          
        
          
            <li><a href="https://www.opennetworking.org/ambassadors/jose-castillo-lema/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-battle-net" aria-hidden="true"></i><span class="label">ONF</span></a></li>
          
        
          
            <li><a href="https://www.youtube.com/channel/UCm5egt_lHxJX-VQdkLPszog/playlists" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-youtube-square" aria-hidden="true"></i><span class="label">YouTube</span></a></li>
          
        
          
            <li><a href="https://josecastillolema.github.io/feed.xml" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i><span class="label">RSS</span></a></li>
          
        
          
            <li><a href="mailto:josecastillolema@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Local Soft-RoCE development workflow with kind">
    <meta itemprop="description" content="RDMA over Converged Ethernet (RoCE) is a network protocol which allows remote direct memory access (RDMA) over an Ethernet network. There are multiple RoCE versions, in particular the RoCE v2 protocol exists on top of either the UDP/IPv4 or the UDP/IPv6 protocol and destination port number 4791 has been reserved for RoCE v2.">
    <meta itemprop="datePublished" content="2025-12-28T00:00:00-06:00">
    <meta itemprop="dateModified" content="2025-12-28T00:00:00-06:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://josecastillolema.github.io/roce-local-dev/" itemprop="url">Local Soft-RoCE development workflow with kind
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
<li><a href="#testing-with-dockerpodman">Testing with Docker/Podman</a></li>
<li><a href="#testing-with-kind">Testing with Kind</a></li>
</ul>
            </nav>
          </aside>
        
        <p>RDMA over Converged Ethernet (RoCE) is a network protocol which allows remote direct memory access (RDMA) over an Ethernet network. There are multiple RoCE versions, in particular the RoCE v2 protocol exists on top of either the UDP/IPv4 or the UDP/IPv6 protocol and destination port number 4791 has been reserved for RoCE v2.</p>

<p>Network-intensive applications like networked storage, cluster computing and Artificial Intelligence workloads need a network infrastructure with a high bandwidth and low latency. The advantages of RDMA over other network application programming interfaces are lower latency, lower CPU load and higher bandwidth.</p>

<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html-single/configuring_infiniband_and_rdma_networks/index#configuring-soft-roce_configuring-roce">Soft-RoCE</a> is a software implementation of remote direct memory access (RDMA) over Ethernet, which is also called RXE. We can use Soft-RoCE on hosts without RoCE host channel adapters (HCA).</p>

<p>We will be using <a href="https://enterprise-support.nvidia.com/s/article/ib-write-bw">ib_write_bw</a> as the network benchmarking tool.</p>

<h2 id="testing-with-dockerpodman">Testing with Docker/Podman</h2>

<ol>
  <li>
    <p>Load the software RoCE module:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>modprobe rdma_rxe
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create RXE on the active interface:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>rdma <span class="nb">link </span>add rxe0 <span class="nb">type </span>rxe netdev eth0
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify configuration:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> rdma <span class="nb">link </span>show
 <span class="nb">link </span>rxe0/1 state ACTIVE physical_state LINK_UP netdev eth0
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check GID setup (this is the tricky part):</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">cat</span> /sys/class/infiniband/rxe0/ports/1/gids/0
 fe80:0000:0000:0000:c805:5eff:fe37:e715

 <span class="nb">cat</span> /sys/class/infiniband/rxe0/ports/1/gids/1
 0000:0000:0000:0000:0000:ffff:c0a8:0117
</code></pre></div>    </div>

    <p>GID 0 is an IPv6 link-local address while GID 1 is an IPv4-mapped IPv6 address:</p>
    <ul>
      <li>GID 0: <code class="language-plaintext highlighter-rouge">fe80:0000:0000:0000:c805:5eff:fe37:e715</code> IPv6 link-local address</li>
      <li>GID 1: <code class="language-plaintext highlighter-rouge">0000:0000:0000:0000:0000:ffff:c0a8:0117</code> IPv4-mapped IPv6 address - 192.168.1.23</li>
    </ul>
  </li>
  <li>
    <p>Create client/server containers with RDMA access:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> docker run <span class="nt">-d</span> <span class="nt">--name</span> server-container <span class="nt">--privileged</span> <span class="se">\</span>
   <span class="nt">--device</span><span class="o">=</span>/dev/infiniband/uverbs0 <span class="se">\</span>
   <span class="nt">--volume</span><span class="o">=</span>/sys/class/infiniband:/sys/class/infiniband:ro <span class="se">\</span>
   quay.io/cloud-bulldozer/k8s-netperf:latest <span class="se">\</span>
   <span class="nb">sleep </span>3600

 docker run <span class="nt">-d</span> <span class="nt">--name</span> client-container <span class="nt">--privileged</span> <span class="se">\</span>
   <span class="nt">--device</span><span class="o">=</span>/dev/infiniband/uverbs0 <span class="se">\</span>
   <span class="nt">--volume</span><span class="o">=</span>/sys/class/infiniband:/sys/class/infiniband:ro <span class="se">\</span>
   quay.io/cloud-bulldozer/k8s-netperf:latest <span class="se">\</span>
   <span class="nb">sleep </span>3600
</code></pre></div>    </div>
  </li>
  <li>
    <p>Get server container IP address:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>docker inspect server-container | <span class="nb">grep </span>IPAddress | <span class="nb">tail</span> <span class="nt">-1</span>
                <span class="s2">"IPAddress"</span>: <span class="s2">"172.17.0.2"</span>,
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run the test:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> docker <span class="nb">exec </span>server-container ib_write_bw <span class="nt">-d</span> rxe0 <span class="nt">-x</span> 1 <span class="nt">-F</span>
 docker <span class="nb">exec </span>client-container ib_write_bw <span class="nt">-d</span> rxe0 <span class="nt">-x</span> 1 <span class="nt">-F</span> 172.17.0.2
 <span class="nt">---------------------------------------------------------------------------------------</span>
                     RDMA_Write BW Test
 Dual-port       : OFF          Device         : rxe0
 Number of qps   : 1            Transport <span class="nb">type</span> : IB
 Connection <span class="nb">type</span> : RC           Using SRQ      : OFF
 PCIe relax order: ON           Lock-free      : OFF
 ibv_wr<span class="k">*</span> API     : OFF          Using DDP      : OFF
 TX depth        : 128
 CQ Moderation   : 1
 CQE Poll Batch  : 16
 Mtu             : 1024[B]
 Link <span class="nb">type</span>       : Ethernet
 GID index       : 1
 Max inline data : 0[B]
 rdma_cm QPs     : OFF
 Data ex. method : Ethernet
 <span class="nt">---------------------------------------------------------------------------------------</span>
 <span class="nb">local </span>address: LID 0000 QPN 0x001f PSN 0xeb83da RKey 0x00108c VAddr 0x007fa70d049000
 GID: 254:128:00:00:00:00:00:00:65:153:129:16:120:165:110:231
 remote address: LID 0000 QPN 0x0020 PSN 0xeb83da RKey 0x00115c VAddr 0x007f3a0742d000
 GID: 254:128:00:00:00:00:00:00:65:153:129:16:120:165:110:231
 <span class="nt">---------------------------------------------------------------------------------------</span>
 <span class="c">#bytes     #iterations    BW peak[MiB/sec]    BW average[MiB/sec]   MsgRate[Mpps]</span>
 65536      5000             1032.41            1024.75              0.016396
 <span class="nt">---------------------------------------------------------------------------------------</span>
</code></pre></div>    </div>

    <p>We obtained an average bandwidth of ~1024 MiB/sec.</p>
  </li>
  <li>
    <p>Cleanup. Remove the containers and the RXE device:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> docker <span class="nb">rm</span> <span class="nt">-f</span> server-container client-container
 <span class="nb">sudo </span>rdma <span class="nb">link </span>delete rxe0
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="testing-with-kind">Testing with Kind</h2>

<p>We will be using <a href="https://github.com/cloud-bulldozer/k8s-netperf/">k8s-netperf</a> as the kubernetes network benchmarking tool. k8s-netperf supports <code class="language-plaintext highlighter-rouge">ib_write_bw</code> as one of its backends.</p>

<ol>
  <li>
    <p>Load the software RoCE module:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>modprobe rdma_rxe
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create RXE on the active interface:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>rdma <span class="nb">link </span>add rxe0 <span class="nb">type </span>rxe netdev eth0
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify configuration:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> rdma <span class="nb">link </span>show
 <span class="nb">link </span>rxe0/1 state ACTIVE physical_state LINK_UP netdev eth0
</code></pre></div>    </div>
  </li>
  <li>
    <p>Let‚Äôs create an RDMA enabled kind cluster config <code class="language-plaintext highlighter-rouge">kind-config-rdma.yaml</code>:</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="na">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
 <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kind.x-k8s.io/v1alpha4</span>
 <span class="na">nodes</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">control-plane</span>
     <span class="na">extraMounts</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/dev/infiniband</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/dev/infiniband</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/sys/class/infiniband</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/sys/class/infiniband</span>
         <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/sys/class/net</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/sys/class/net</span>
         <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
   <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
     <span class="na">extraMounts</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/dev/infiniband</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/dev/infiniband</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/sys/class/infiniband</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/sys/class/infiniband</span>
         <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/sys/class/net</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/sys/class/net</span>
         <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
   <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
     <span class="na">extraMounts</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/dev/infiniband</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/dev/infiniband</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/sys/class/infiniband</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/sys/class/infiniband</span>
         <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
       <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span> <span class="s">/sys/class/net</span>
         <span class="na">containerPath</span><span class="pi">:</span> <span class="s">/sys/class/net</span>
         <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create the kind cluster:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> kind create cluster <span class="nt">--config</span> kind-config-rdma.yaml
 Creating cluster <span class="s2">"kind"</span> ...
  ‚úì Ensuring node image <span class="o">(</span>kindest/node:v1.32.2<span class="o">)</span> üñº
  ‚úì Preparing nodes üì¶ üì¶ üì¶
  ‚úì Writing configuration üìú
  ‚úì Starting control-plane üïπÔ∏è
  ‚úì Installing CNI üîå
  ‚úì Installing StorageClass üíæ
  ‚úì Joining worker nodes üöú
</code></pre></div>    </div>
  </li>
  <li>
    <p>Label the nodes:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> kubectl label node kind-worker  node-role.kubernetes.io/worker<span class="o">=</span><span class="s2">""</span>
 kubectl label node kind-worker2 node-role.kubernetes.io/worker<span class="o">=</span><span class="s2">""</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a k8s-netperf config file for RoCEv2 traffic <code class="language-plaintext highlighter-rouge">config.yaml</code>:</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="s">---</span>
 <span class="s">tests</span><span class="err">:</span>
   <span class="pi">-</span> <span class="na">UDPStream</span><span class="pi">:</span>
     <span class="na">parallelism</span><span class="pi">:</span> <span class="m">1</span>
     <span class="na">profile</span><span class="pi">:</span> <span class="s2">"</span><span class="s">UDP_STREAM"</span>
     <span class="na">duration</span><span class="pi">:</span> <span class="m">5</span>
     <span class="na">samples</span><span class="pi">:</span> <span class="m">1</span>
     <span class="na">messagesize</span><span class="pi">:</span> <span class="m">1024</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run the test:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> k8s-netperf <span class="nt">--config</span> config.yaml <span class="nt">--hostNet</span> <span class="nt">--privileged</span> <span class="nt">--ib-write-bw</span> rxe0:1
 INFO[2025-12-28 11:29:38] Starting k8s-netperf <span class="o">(</span>roce2@e2988034e0f9dd4e2a59f131f6ae7866b12fd6de<span class="o">)</span>
 INFO[2025-12-28 11:29:38] üìí Reading config.yaml file.
 INFO[2025-12-28 11:29:38] üìí Reading config.yaml file - using ConfigV2 Method.
 WARN[2025-12-28 11:29:38] üò• Prometheus is not available
 INFO[2025-12-28 11:29:38] üî® Creating namespace: netperf
 INFO[2025-12-28 11:29:38] üî® Creating service account: netperf
 WARN[2025-12-28 11:29:38] ‚ö†Ô∏è  No zone label
 WARN[2025-12-28 11:29:38] ‚ö†Ô∏è  Single node per zone and/or no zone labels
 INFO[2025-12-28 11:29:38] üöÄ Starting Deployment <span class="k">for</span>: client-host <span class="k">in </span>namespace: netperf
 INFO[2025-12-28 11:29:38] ‚è∞ Checking <span class="k">for </span>client-host Pods to become ready...
 INFO[2025-12-28 11:29:56] Looking <span class="k">for </span>pods with label <span class="nv">role</span><span class="o">=</span>host-client
 INFO[2025-12-28 11:29:56] üöÄ Starting Deployment <span class="k">for</span>: server-host <span class="k">in </span>namespace: netperf
 INFO[2025-12-28 11:29:56] ‚è∞ Checking <span class="k">for </span>server-host Pods to become ready...
 INFO[2025-12-28 11:30:11] Looking <span class="k">for </span>pods with label <span class="nv">role</span><span class="o">=</span>host-server
 INFO[2025-12-28 11:30:16] üóíÔ∏è  Running ib_write_bw UDP_STREAM <span class="o">(</span>service <span class="nb">false</span><span class="o">)</span> <span class="k">for </span>5s
 WARN[2025-12-28 11:30:22] Not able to collect OpenShift specific node info
 +-------------------+-------------+------------+-------------+--------------+---------+-----------------+----------+-------------+--------------+-------+-----------+----------+---------+-------------------+--------------------------+
 |    RESULT TYPE    |   DRIVER    |  SCENARIO  | PARALLELISM | HOST NETWORK | SERVICE | EXTERNAL SERVER | UDN INFO | BRIDGE INFO | MESSAGE SIZE | BURST | SAME NODE | DURATION | SAMPLES |     AVG VALUE     | 95% CONFIDENCE INTERVAL  |
 +-------------------+-------------+------------+-------------+--------------+---------+-----------------+----------+-------------+--------------+-------+-----------+----------+---------+-------------------+--------------------------+
 | üìä Stream Results | ib_write_bw | UDP_STREAM | 1           | <span class="nb">true</span>         | <span class="nb">false</span>   | <span class="nb">false</span>           |          |             | 1024         | 0     | <span class="nb">false</span>     | 5        | 1       | 935.110000 <span class="o">(</span>Mb/s<span class="o">)</span> | 0.000000-0.000000 <span class="o">(</span>Mb/s<span class="o">)</span> |
 +-------------------+-------------+------------+-------------+--------------+---------+-----------------+----------+-------------+--------------+-------+-----------+----------+---------+-------------------+--------------------------+
 +------------------+-------------+------------+-------------+--------------+---------+-----------------+----------+-------------+--------------+-------+-----------+----------+---------+-----------+
 |       TYPE       |   DRIVER    |  SCENARIO  | PARALLELISM | HOST NETWORK | SERVICE | EXTERNAL SERVER | UDN INFO | BRIDGE INFO | MESSAGE SIZE | BURST | SAME NODE | DURATION | SAMPLES | AVG VALUE |
 +------------------+-------------+------------+-------------+--------------+---------+-----------------+----------+-------------+--------------+-------+-----------+----------+---------+-----------+
 | UDP Loss Percent | ib_write_bw | UDP_STREAM | 1           | <span class="nb">true</span>         | <span class="nb">false</span>   | <span class="nb">false</span>           |          |             | 1024         | 0     | <span class="nb">false</span>     | 5        | 1       | 0.000000  |
 +------------------+-------------+------------+-------------+--------------+---------+-----------------+----------+-------------+--------------+-------+-----------+----------+---------+-----------+
 INFO[2025-12-28 11:30:22] Cleaning resources created by k8s-netperf
 INFO[2025-12-28 11:30:22] ‚è∞ Waiting <span class="k">for </span>netperf Namespace to be deleted...
</code></pre></div>    </div>

    <p>The average bandwidth was ~935 MiB/sec.</p>
  </li>
  <li>
    <p>Cleanup. Remove the kind cluster and the RXE device:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> kind delete cluster
 <span class="nb">sudo </span>rdma <span class="nb">link </span>delete rxe0
</code></pre></div>    </div>
  </li>
</ol>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#dev" class="page__taxonomy-item p-category" rel="tag">dev</a><span class="sep">, </span>
    
      <a href="/tags/#en" class="page__taxonomy-item p-category" rel="tag">en</a><span class="sep">, </span>
    
      <a href="/tags/#networks" class="page__taxonomy-item p-category" rel="tag">networks</a><span class="sep">, </span>
    
      <a href="/tags/#redhat" class="page__taxonomy-item p-category" rel="tag">redhat</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-12-28">December 28, 2025</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?text=Local+Soft-RoCE+development+workflow+with+kind%20https%3A%2F%2Fjosecastillolema.github.io%2Froce-local-dev%2F" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjosecastillolema.github.io%2Froce-local-dev%2F" class="btn btn--facebook" aria-label="Share on Facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook">
    <i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://josecastillolema.github.io/roce-local-dev/" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

  <a href="https://bsky.app/intent/compose?text=Local+Soft-RoCE+development+workflow+with+kind%20https%3A%2F%2Fjosecastillolema.github.io%2Froce-local-dev%2F" class="btn btn--bluesky" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Bluesky">
    <i class="fab fa-fw fa-bluesky" aria-hidden="true"></i><span> Bluesky</span>
  </a>
</section>


      
  <nav class="pagination">
    
      <a href="/ovscon25/" class="pagination--pager" title="Open vSwitch and OVN 2025 Fall Conference">Previous</a>
    
    
      <a href="/newyear26/" class="pagination--pager" title="Happy new year!">Next</a>
    
  </nav>


    </div>

    
      
        <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

      
    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You May Also Enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/favicon_io/android-chrome-512x512.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/newyear26/" rel="permalink">Happy new year!
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/favicon_io/android-chrome-512x512.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ovscon25/" rel="permalink">Open vSwitch and OVN 2025 Fall Conference
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/favicon_io/android-chrome-512x512.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/oscd25/" rel="permalink">Open Source Community Day 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">The Open Source Community Day, organised by the Eclipse Foundation in collaboration with EUCloudEdgeIoT.eu, is a vibrant gathering of individuals united by a...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/favicon_io/android-chrome-512x512.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/rhrq-multicluster-k8s/" rel="permalink">RHRQ: Bridging clusters, a comparative look at multicluster networking performance in Kubernetes
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/josecastillolema" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/jose-castillo-lema" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://stackoverflow.com/users/4288758/jos%c3%a9-castillo-lema" rel="nofollow noopener noreferrer"><i class="fab fa-stack-overflow" aria-hidden="true"></i> Stack Overflow</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">¬© 2026 <a href="https://josecastillolema.github.io">GitOps</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1EBHNQEGXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1EBHNQEGXG', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://josecastillolema.github.io/roce-local-dev/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/roce-local-dev"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://https-josecastillolema-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  





  </body>
</html>
